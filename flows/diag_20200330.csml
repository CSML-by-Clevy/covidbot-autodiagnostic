start:
  say Typing(3000)
  say "Bienvenue sur le test *d'autodiagnostic COVID-19*, rÃ©alisÃ© en partenariat avec *l'Institut Pasteur*, *l'AP-HP* et le *MinistÃ¨re de la santÃ©*."
  say Typing(2000)
	say "âš ï¸ Attention, ce site dâ€™information *nâ€™est pas un dispositif mÃ©dical*, il ne dÃ©livre pas dâ€™avis mÃ©dical."
	say Typing(3000)
	say "*ðŸš¨Information Importante ðŸš¨* : la prise d'anti-inflammatoires (ibuprofÃ¨ne, cortisone ...) pourrait Ãªtre un facteur d'aggravation de lâ€™infection."
	say "En cas de fiÃ¨vre ðŸ¤’, prenez du paracÃ©tamol. Si vous Ãªtes dÃ©jÃ  sous anti-inflammatoires ou en cas de doute, demandez conseil Ã  votre mÃ©decin ðŸ‘¨â€âš•ï¸ðŸ‘©â€âš•ï¸."
  say Typing(4000)
	say "*Avant de commencer, veuillez lire le prÃ©ambule Ã  l'utilisation du service :*"
	say Url("https://bit.ly/prÃ©ambule")
	say Typing(2000)
	say Question(
		"*Â« Je reconnais avoir lu le prÃ©ambule et souhaite dÃ©marrer le test Â»*",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
    ]
  )
	hold
	if (event match btnyes) {
		say "Allons-y."
		say Typing (2000)
		goto q1
	} else {
		say Question(
      "C'est notÃ©. Bonne journÃ©e ! ðŸ™‚",
      buttons=[Button("Recommencer")]
    )
    hold
    goto start
	}
	goto end


q1:
	say Question(
		"*1/21* : Pensez-vous avoir eu de la fieÌ€vre ces derniers jours (frissons, sueurs) ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno,
			Button("Ne sait pas", accepts=["ne sait pas", "ne sais pas", "Ne sais pas", "Je ne sais pas", "je ne sais pas", "ne sais pas"]) as btnnsp
		])
	hold
	if (event match btnyes || event match btnnsp) {
		remember hasTemp = 1
		goto q1bis
	} else if (event match btnno) {
		remember hasTemp = 0
		// Verifier la valeur envoyÃ©e Ã  l'api de `temp`
		remember temp = 0
		goto q2
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons."
		goto q1
	}

q1bis:
	say "*1bis/21* : Quelle est votre tempÃ©rature corporelle (ex: 38) ?"
	hold
	do Fn("norm_units", string=event) as parsedTemp
	if (!parsedTemp) {
		say "Veuillez saisir une tempÃ©rature valide."
		goto q1bis
	}
	if (parsedTemp.is_number() && parsedTemp >= 34 && parsedTemp <= 42) {
		remember temp = parsedTemp
		goto q2
	} else {
		say "Veuillez saisir une tempÃ©rature valide, entre 34 et 42 degrÃ©s."
		goto q1bis
	}

q2:
	say Question(
		"*2/21* : Avez-vous *une toux ou une augmentation de votre toux* habituelle ces derniers jours ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasCaugh = 1
		goto q3
	} else if (event match btnno) {
		remember hasCaugh = 0
		goto q3
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons."
		goto q2
	}

q3:
	say Question(
		"*3/21* : Ces derniers jours, avez-vous notÃ© une *forte diminution ou perte de votre goÃ»t ou de votre odorat* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasNoTaste = 1
		goto q4
	} else if (event match btnno) {
		remember hasNoTaste = 0
		goto q4
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q3
	}


q4:
	say Question(
		"*4/21* : Avez-vous un *mal de gorge* ou des *douleurs musculaires* ou des *courbatures* inhabituelles ces derniers jours ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasPainfulThroatMuscle = 1
		goto q5
	} else if (event match btnno) {
		remember hasPainfulThroatMuscle = 0
		goto q5
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q4
	}

q5:
	say Question(
		"*5/21* : Ces derniÃ¨res 24 heures, avez-vous de la *diarrhÃ©e* ? Avec au moins 3 selles molles.",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasDiarrhea = 1
		goto q6
	} else if (event match btnno) {
		remember hasDiarrhea = 0
		goto q6
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q5
	}

q6:
	say Question(
		"*6/21* : Ces derniers jours, avez-vous une *fatigue inhabituelle* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasFatigue = 1
		goto q6bis
	} else if (event match btnno) {
		remember hasFatigue = 0
		remember hasDailyNap = 0
		goto q7
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q6
	}

q6bis:
	say Question(
		"*6bis/21* : Cette fatigue vous oblige-t-elle Ã  vous reposer plus de la moitiÃ© de la journÃ©e ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasDailyNap = 1
		goto q7
	} else if (event match btnno) {
		remember hasDailyNap = 0
		goto q7
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q6bis
	}

q7:
	say Question(
		"*7/21* : ÃŠtes vous dans l'impossibilitÃ© de vous alimenter ou de boire *DEPUIS 24 HEURES OU PLUS* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasFeedStruggle = 1
		goto q8
	} else if (event match btnno) {
		remember hasFeedStruggle = 0
		goto q8
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q7
	}

q8:
	say Question(
		"*8/21* : Dans les derniÃ¨res 24 heures, avez-vous notÃ© un *manque de souffle INHABITUEL* lorsque vous parlez ou faites un petit effort ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasSOB = 1
		goto q9
	} else if (event match btnno) {
		remember hasSOB = 0
		goto q9
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q8
	}

q9:
	say "*9/21* : Quel est votre Ã¢ge ? Ceci, afin de calculer un facteur de risque spÃ©cifique (ex: 28)."
	hold
	do Fn("norm_units", string=event) as parsedAge
	if (!parsedAge) {
		say "Veuillez saisir un age valide."
		goto q9
	}
	if (parsedAge.is_number() && parsedAge > 15 && parsedAge <= 110) {
		remember age = parsedAge
		goto q10
	} else if (parsedAge <= 15 && parsedAge >= 0) {
		say "En l'absence de recommandations connues pour les affections pÃ©diatriques (de moins de 15 ans), il faut rechercher un avis mÃ©dical pour tout symptÃ´me sur les enfants. Si l'Ã©tat de santÃ© du patient semble inquiÃ©tant, appelez le 15."
		goto end
	} else if (parsedAge >= 100 && parsedAge <= 110) {
		say "Au-delÃ  d'un certain Ã¢ge, nous ne sommes pas en mesure de fournir des recommendations fiables, il faut rechercher un avis mÃ©dical pour tout symptÃ´me. Si l'Ã©tat de santÃ© du patient semble inquiÃ©tant, appelez le 15."
		goto end
	} else {
		say "Veuillez saisir un age valide."
		goto q9
	}

q10:
	say "*10/21* : Quel est votre *taille* en centimetres (ex: 175) ? Afin de calculer lâ€™indice de masse corporelle qui est un facteur influenÃ§ant le risque de complications de lâ€™infection."
	hold
	do Fn("norm_units", string=event) as parsedSize
	if (!parsedSize) {
		say "Veuillez saisir une taille valide, entre 80 et 250 cm."
		goto q10
	}
	if (parsedSize < 10) do normSize = parsedSize * 100
	else do normSize = parsedSize
	if (normSize.is_number() && normSize >= 80 && normSize <= 250) {
		remember size = normSize
		goto q11
	} else {
		say "Veuillez saisir une taille valide, entre 80 et 250 cm."
		goto q10
	}

q11:
	say "*11/21* : Quel est votre *poids* en kilogrammes (ex: 84) ? Afin de calculer lâ€™indice de masse corporelle qui est un facteur influenÃ§ant le risque de complications de lâ€™infection. "
	hold
	do Fn("norm_units", string=event) as parsedWeight
	if (!parsedWeight) {
		say "Veuillez saisir un poids valide, entre 20 et 250 kg."
		goto q11
	}
	if (parsedWeight.is_number() && parsedWeight >= 20 && parsedWeight <= 250) {
		remember weight = parsedWeight
		goto q12
	} else {
		say "Veuillez saisir un poids valide, entre 20 et 250 kg."
		goto q11
	}

q12:
	say Question(
		"*12/21* : Avez-vous de *lâ€™hypertension artÃ©rielle* mal Ã©quilibrÃ©e ? Ou avez-vous une *maladie cardiaque ou vasculaire* ? Ou prenez-vous un *traitement Ã  visÃ©e cardiologique* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno,
			Button("Ne sait pas", accepts=["ne sait pas", "ne sais pas", "Ne sais pas", "Je ne sais pas", "je ne sais pas", "ne sais pas"]) as btnnsp
		])
	hold
	if (event match btnyes) {
		remember hasCARDISSUE = 1
		goto q13
	} else if (event match btnno) {
		remember hasCARDISSUE = 0
		goto q13
	} else if (event match btnnsp) {
		remember hasCARDISSUE = 2
		goto q13
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q12
	}

q13:
	say Question(
		"*13/21* : ÃŠtes-vous diabÃ©tique ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasDiabetes = 1
		goto q14
	} else if (event match btnno) {
		remember hasDiabetes = 0
		goto q14
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q13
	}

q14:
	say Question(
		"*14/21* : Avez-vous ou avez-vous eu un *cancer* dans les 3 dernieÌ€res anneÌes ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasCancer = 1
		goto q15
	} else if (event match btnno) {
		remember hasCancer = 0
		goto q15
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q14
	}

q15:
	say Question(
		"*15/21* : Avez-vous une *maladie respiratoire* ? Ou Ãªtes-vous *suivi par un pneumologue* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasBreathingIllness = 1
		goto q16
	} else if (event match btnno) {
		remember hasBreathingIllness = 0
		goto q16
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q15
	}

q16:
	say Question(
		"*16/21* : Avez-vous une *insuffisance rÃ©nale chronique dialysÃ©e* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasKidneyFailure = 1
		goto q17
	} else if (event match btnno) {
		remember hasKidneyFailure = 0
		goto q17
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q16
	}

q17:
	say Question(
		"*17/21* : Avez-vous une *maladie chronique du foie* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno
		])
	hold
	if (event match btnyes) {
		remember hasLiverIllness = 1
		goto q18
	} else if (event match btnno) {
		remember hasLiverIllness = 0
		goto q18
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q17
	}

q18:
	say Question(
		"*18/21* : ÃŠtes-vous *enceinte* ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno,
			Button("Non applicable", accepts=["non applicable", "Pas applicable", "na", "n/a", "N/A", "NA"]) as btnna
		])
	hold
	if (event match btnyes) {
		remember isPregnant = 1
		goto q19
	} else if (event match btnno) {
		remember isPregnant = 0
		goto q19
	} else if (event match btnna) {
		remember isPregnant = 2
		goto q19
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q18
	}

q19:
	say Question(
		"*19/21* : Avez-vous une maladie connue pour diminuer vos dÃ©fenses immunitaires ?",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno,
			Button("Ne sait pas", accepts=["ne sait pas", "ne sais pas", "Ne sais pas", "Je ne sais pas", "je ne sais pas", "ne sais pas"]) as btnnsp
		])
	hold
	if (event match btnyes) {
		remember hasImuneSystemFailure = 1
		goto q20
	} else if (event match btnno) {
		remember hasImuneSystemFailure = 0
		goto q20
	} else if (event match btnnsp) {
		remember hasImuneSystemFailure = 2
		goto q20
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q19
	}

q20:
	say Question(
		"*20/21* : Prenez-vous un *traitement immunosuppresseur* ? Câ€™est un traitement qui diminue vos dÃ©fenses contre les infections. Voici quelques exemples : corticoÃ¯des, mÃ©thotrexate, ciclosporine, tacrolimus, azathioprine, cyclophosphamide (liste non exhaustive).",
		buttons=[
			Button("Oui", accepts=["oui", "yes", "Yes", "Ouais", "ouais"]) as btnyes,
			Button("Non", accepts=["non", "no", "Nope", "nope", "No", "Pas du tout"]) as btnno,
			Button("Ne sait pas", accepts=["ne sait pas", "ne sais pas", "Ne sais pas", "Je ne sais pas", "je ne sais pas", "ne sais pas"]) as btnnsp
		])
	hold
	if (event match btnyes) {
		remember hasImmunosuppresseur = 1
		goto q21
	} else if (event match btnno) {
		remember hasImmunosuppresseur = 0
		goto q21
	} else if (event match btnnsp) {
		remember hasImmunosuppresseur = 2
		goto q21
	} else {
		say "Veuillez s'il vous plait cliquer sur un des boutons"
		goto q20
	}

q21:
	say Question(
		"*21/21* : Quel est votre code postal ?",
		buttons = [
			Button("Je ne suis pas en France",
				accepts=[
					"Pas en France",
					"pas en france",
					"Pas en france",
					"pas en France"
				]
			) as btnhorsfr
		])
	hold
	if (event match btnhorsfr) {
		remember location = "horsFR"
	} else {
		remember location = event
	}
	goto bufferStep

bufferStep:
	if (done == 1) {
		remember done = 0
		goto end
	}
	remember done = 1
	goto flow diag_20200330_algo
